"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[52],{6052:function(e,t,n){n.r(t),n.d(t,{default:function(){return components_GotchiBankingServices}});var a=n(5893),s=n(7294),l=n(1376),i=n(4476),o=n(7583),r=n(8470),c=n(9554),d=n(8535);let formatNumberWithCommas=e=>{if(!e)return"0";let[t,n]=e.split("."),a=t.replace(/\B(?=(\d{3})+(?!\d))/g,",");return n?"".concat(a,".").concat(n):a};var u=n(8532),m=n(250),p=n(1126);let h="0x86935F11C86623deC8a25696E1C19a8659CbF95d",g="0x385Eeac5cB85A38A9a07A70c73e0a3271CfB54A7",y=[{inputs:[{internalType:"uint256",name:"_tokenId",type:"uint256"},{internalType:"address",name:"_erc20Contract",type:"address"},{internalType:"address",name:"_recipient",type:"address"},{internalType:"uint256",name:"_transferAmount",type:"uint256"}],name:"transferEscrow",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_tokenIds",type:"uint256[]"},{internalType:"address[]",name:"_erc20Contracts",type:"address[]"},{internalType:"address[]",name:"_recipients",type:"address[]"},{internalType:"uint256[]",name:"_transferAmounts",type:"uint256[]"}],name:"batchTransferEscrow",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"tokenIdsOfOwner",outputs:[{internalType:"uint32[]",name:"tokenIds_",type:"uint32[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint32[]",name:"_tokenIds",type:"uint32[]"}],name:"getAavegotchisBatch",outputs:[{components:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"randomNumber",type:"uint256"},{internalType:"uint256",name:"status",type:"uint256"},{internalType:"int16[6]",name:"numericTraits",type:"int16[6]"},{internalType:"int16[6]",name:"modifiedNumericTraits",type:"int16[6]"},{internalType:"uint16[16]",name:"equippedWearables",type:"uint16[16]"},{internalType:"address",name:"collateral",type:"address"},{internalType:"address",name:"escrow",type:"address"},{internalType:"uint256",name:"stakedAmount",type:"uint256"},{internalType:"uint256",name:"minimumStake",type:"uint256"},{internalType:"uint256",name:"kinship",type:"uint256"},{internalType:"uint256",name:"lastInteracted",type:"uint256"},{internalType:"uint256",name:"experience",type:"uint256"},{internalType:"uint256",name:"toNextLevel",type:"uint256"},{internalType:"uint256",name:"usedSkillPoints",type:"uint256"},{internalType:"uint256",name:"level",type:"uint256"},{internalType:"uint256",name:"hauntId",type:"uint256"},{internalType:"uint256",name:"baseRarityScore",type:"uint256"},{internalType:"uint256",name:"modifiedRarityScore",type:"uint256"},{internalType:"bool",name:"locked",type:"bool"},{internalType:"address",name:"lending",type:"address"}],internalType:"struct AavegotchiInfo[]",name:"aavegotchiInfos_",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"uint256",name:"_index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"getAavegotchi",outputs:[{components:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"randomNumber",type:"uint256"},{internalType:"uint256",name:"status",type:"uint256"},{internalType:"int16[6]",name:"numericTraits",type:"int16[6]"},{internalType:"int16[6]",name:"modifiedNumericTraits",type:"int16[6]"},{internalType:"uint16[16]",name:"equippedWearables",type:"uint16[16]"},{internalType:"address",name:"collateral",type:"address"},{internalType:"address",name:"escrow",type:"address"},{internalType:"uint256",name:"stakedAmount",type:"uint256"},{internalType:"uint256",name:"minimumStake",type:"uint256"},{internalType:"uint256",name:"kinship",type:"uint256"},{internalType:"uint256",name:"lastInteracted",type:"uint256"},{internalType:"uint256",name:"experience",type:"uint256"},{internalType:"uint256",name:"toNextLevel",type:"uint256"},{internalType:"uint256",name:"usedSkillPoints",type:"uint256"},{internalType:"uint256",name:"level",type:"uint256"},{internalType:"uint256",name:"hauntId",type:"uint256"},{internalType:"uint256",name:"baseRarityScore",type:"uint256"},{internalType:"uint256",name:"modifiedRarityScore",type:"uint256"},{internalType:"bool",name:"locked",type:"bool"},{components:[{internalType:"address",name:"lender",type:"address"},{internalType:"address",name:"borrower",type:"address"},{internalType:"uint96",name:"timeAgreed",type:"uint96"},{internalType:"address",name:"originalOwner",type:"address"}],internalType:"struct AavegotchiInfo.Lending",name:"lending",type:"tuple"}],internalType:"struct AavegotchiInfo.Aavegotchi",name:"aavegotchi_",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint32",name:"_erc721TokenId",type:"uint32"}],name:"isAavegotchiLent",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],w=[{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"}];p.N;let b=[{inputs:[{internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"getAavegotchiSvg",outputs:[{internalType:"string",name:"svg_",type:"string"}],stateMutability:"view",type:"function"}];var f=n(3935),components_AavegotchiThumbnail=e=>{let{tokenId:t,signer:n,displayMode:l,size:i=56}=e,[r,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[p,g]=(0,s.useState)({top:0,left:0}),[y,w]=(0,s.useState)(!1),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{w(!0)},[]),(0,s.useEffect)(()=>{let fetchSvg=async()=>{if(t&&n){let e=new o.CH(h,b,n);try{let n=await e.getAavegotchiSvg(t),a=new Blob([n],{type:"image/svg+xml"}),s=URL.createObjectURL(a);c(s)}catch(e){console.error("Error fetching Aavegotchi SVG for token ID ".concat(t,":"),e)}}else c(null)};return fetchSvg(),()=>{r&&URL.revokeObjectURL(r)}},[t,n]);let k=u&&r&&(0,a.jsx)("div",{className:(0,d.cn)("fixed p-2 border border-white/20 rounded-xl shadow-glass bg-white/10 backdrop-blur-lg","pointer-events-none","z-50"),style:{top:"".concat(p.top,"px"),left:"".concat(p.left,"px")},children:(0,a.jsx)("img",{src:r,alt:"Aavegotchi ".concat(t),className:(0,d.cn)("w-32 h-32 object-contain rounded-full")})});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{ref:x,className:(0,d.cn)("inline-block relative"),style:{width:"".concat(i,"px"),height:"".concat(i,"px")},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onMouseMove:e=>{let{clientX:t,clientY:n}=e;g({top:n+10,left:t+10})},children:r?(0,a.jsx)("img",{src:r,alt:"Aavegotchi ".concat(t),className:(0,d.cn)("w-full h-full object-contain rounded-full border border-white/20")}):(0,a.jsx)("div",{className:(0,d.cn)("w-full h-full bg-gray-200 flex items-center justify-center text-xs"),children:"Loading..."})}),y&&f.createPortal(k,document.body)]})},x=n(7836),components_TopSection=e=>{let{contractAddress:t,network:n,walletAddress:l,onConnectWallet:i,aavegotchis:o,customTokenSymbol:r,isCustomToken:c,tokenImage:p,isDarkMode:h,toggleDarkMode:g,signer:y}=e,[w,b]=(0,s.useState)({show:!1,message:""}),[f,k]=(0,s.useState)(window.innerWidth);(0,s.useRef)(null);let[v,T]=(0,s.useState)("/images/default-token.png");(0,s.useEffect)(()=>{let handleResize=()=>k(window.innerWidth);return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]);let copyToClipboard=e=>{navigator.clipboard.writeText(e).then(()=>{b({show:!0,message:"Copied to clipboard!"})}).catch(e=>{console.error("Failed to copy text: ",e),b({show:!0,message:"Failed to copy"})})};return(0,s.useEffect)(()=>{if(w.show){let e=setTimeout(()=>{b({show:!1,message:""})},3e3);return()=>clearTimeout(e)}},[w.show]),(0,s.useEffect)(()=>{if(p){let e=new Image;e.onload=()=>T(p),e.onerror=()=>T("/images/default-token.png"),e.src=p}},[p]),(0,a.jsxs)("div",{className:(0,d.cn)("space-y-4 w-full"),children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,a.jsx)("h1",{className:(0,d.cn)("text-2xl md:text-4xl font-heading text-glass text-center px-4"),children:"Aavegotchi Banking Services"}),(0,a.jsx)(x.E.button,{onClick:g,className:(0,d.cn)("absolute right-0 p-2 rounded-full bg-white/20 dark:bg-black/20 mr-0","shadow-glass"),"aria-label":"Toggle Dark Mode",whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.1},children:h?(0,a.jsx)(u.Z,{className:"w-6 h-6 text-yellow-400"}):(0,a.jsx)(m.Z,{className:"w-6 h-6 text-gray-800"})})]}),(0,a.jsxs)("div",{className:(0,d.cn)("p-4 glassmorphism"),children:[(0,a.jsxs)("p",{className:"font-base text-glass break-words",children:["Network: ",n]}),(0,a.jsxs)("p",{className:"font-base text-glass break-all",children:["Contract: ",t]})]}),(0,a.jsx)("div",{className:(0,d.cn)("p-4 glassmorphism"),children:l?(0,a.jsxs)("p",{className:"font-base text-glass",children:["Connected: ",l.slice(0,6),"...",l.slice(-4)]}):(0,a.jsx)(x.E.button,{className:(0,d.cn)("w-full bg-white/20 dark:bg-black/20 px-4 py-2 font-base text-glass border border-white/30 dark:border-black/30 rounded-xl shadow-glass","hover:bg-white/30 dark:hover:bg-black/30 transition-all"),onClick:i,whileHover:{scale:1.02},whileTap:{scale:.98},transition:{duration:.1},children:"Connect Wallet"})}),(0,a.jsxs)("div",{className:(0,d.cn)("p-4 glassmorphism"),children:[(0,a.jsx)("h2",{className:(0,d.cn)("text-xl md:text-2xl font-heading mb-4 text-glass text-center"),children:"Aavegotchi Tokens"}),(0,a.jsx)("div",{className:"table-container",children:(0,a.jsxs)("table",{className:(0,d.cn)("responsive-table w-full"),children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-white/20 dark:bg-black/20",children:[(0,a.jsx)("th",{className:"p-2 font-base text-glass text-center",children:"GOTCHI"}),(0,a.jsx)("th",{className:"p-2 font-base text-glass text-center",children:"NAME"}),(0,a.jsx)("th",{className:"p-2 font-base text-glass text-center",children:"ESCROW WALLET"}),(0,a.jsx)("th",{className:"p-2 font-base text-glass text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsxs)("span",{children:[c&&r?r:"GHST"," BALANCE"]}),v&&(0,a.jsx)("div",{className:"ml-2 w-6 h-6 overflow-hidden rounded-full",children:(0,a.jsx)("img",{src:v,alt:c?r:"GHST",className:"w-full h-full object-cover"})})]})}),(0,a.jsx)("th",{className:"p-2 font-base text-glass text-center",children:"OWNERSHIP"})]})}),(0,a.jsx)("tbody",{children:o.map((e,t)=>(0,a.jsxs)("tr",{className:t%2==0?"bg-white/10 dark:bg-black/10":"bg-white/20 dark:bg-black/20",children:[(0,a.jsx)("td",{className:"p-2 font-base text-glass text-center",children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(components_AavegotchiThumbnail,{tokenId:e.tokenId,signer:y,displayMode:"thumbnail",size:56})})}),(0,a.jsx)("td",{className:"p-2 font-base text-glass text-center","data-label":"NAME",children:e.name||"Aavegotchi #".concat(e.tokenId)}),(0,a.jsxs)("td",{className:"p-2 font-base text-glass text-center","data-label":"ESCROW WALLET",children:[e.escrowWallet.slice(0,6),"...",e.escrowWallet.slice(-4),(0,a.jsx)(x.E.button,{onClick:()=>copyToClipboard(e.escrowWallet),className:(0,d.cn)("ml-2 bg-white/20 dark:bg-black/20 px-2 py-1 font-base text-glass","border border-white/30 dark:border-black/30 rounded","shadow-glass","hover:bg-white/30 dark:hover:bg-black/30 transition-all"),whileHover:{scale:1.05},whileTap:{scale:.95},transition:{duration:.1},children:"Copy"})]}),(0,a.jsx)("td",{className:"p-2 font-base text-glass text-center","data-label":"".concat(c&&r?r:"GHST"," BALANCE"),children:formatNumberWithCommas(parseFloat(c?e.customTokenBalance||"0":e.ghstBalance).toFixed(4))}),(0,a.jsx)("td",{className:"p-2 font-base text-glass text-center","data-label":"OWNERSHIP",children:(0,a.jsx)("span",{className:(0,d.cn)("px-2 py-1 rounded",e.isLent?"bg-white/20 dark:bg-black/20":"bg-white/10 dark:bg-black/10"),children:e.isLent?"\uD83D\uDD11 Rented":"\uD83C\uDFE0 Owned"})})]},e.tokenId))})]})})]}),w.show&&(0,a.jsx)("div",{className:(0,d.cn)("fixed bottom-4 right-4 p-4 glassmorphism z-50"),children:(0,a.jsx)("p",{className:"font-base text-glass",children:w.message})})]})};let WithdrawalForm=e=>{let{aavegotchis:t,onWithdraw:n,onCustomTokenChange:l,signer:i,onTokenSelection:c,tokenSymbol:u,onCustomTokenInvalid:m,tokenDecimals:p,isDarkMode:w,tokenOption:b,customTokenAddress:f}=e,[k,v]=(0,s.useState)([]),[T,j]=(0,s.useState)(""),[N,C]=(0,s.useState)(!1),[A,I]=(0,s.useState)(null),S=t.filter(e=>!e.isLent);(0,s.useEffect)(()=>{S.length>0&&0===k.length&&v(S.map(e=>e.tokenId))},[S]);let calculateProportionalWithdrawals=(e,t)=>{let n=e.reduce((e,t)=>{let n="ghst"===b.toLowerCase()?t.ghstBalance:t.customTokenBalance||"0";return e+r.vz(n,p)},BigInt(0));if(n===BigInt(0))return e.map(e=>({tokenId:BigInt(e.tokenId),amount:BigInt(0)}));let a=t,s=e.map(e=>{let s="ghst"===b.toLowerCase()?e.ghstBalance:e.customTokenBalance||"0",l=r.vz(s,p),i=l*t/n;return i>a?{tokenId:BigInt(e.tokenId),amount:a}:(a-=i,{tokenId:BigInt(e.tokenId),amount:i})});if(a>0)for(let e=0;e<s.length&&a>0;e++){let t=BigInt(1);s[e].amount+=t,a-=t}return s},handleSubmit=async e=>{if(e.preventDefault(),!i){console.error("Signer not initialized");return}C(!0),I(null);try{let e="ghst"===b.toLowerCase()?g:f,t=new o.CH(h,y,i),a=await i.getAddress(),s=S.filter(e=>k.includes(e.tokenId)),l=r.vz(T,p);if(0===s.length)throw Error("No Aavegotchis selected");let c=s.reduce((e,t)=>{let n="ghst"===b.toLowerCase()?t.ghstBalance:t.customTokenBalance||"0",a=r.vz(n,p);return e+a},BigInt(0));if(l>c)throw Error("Not enough balance in selected Aavegotchis to withdraw the total amount requested.");let d=calculateProportionalWithdrawals(s,l);console.log("Attempting batch withdrawal:"),d.forEach(e=>console.log("Aavegotchi ".concat(e.tokenId,": ").concat(r.bM(e.amount,p)))),await t.batchTransferEscrow(d.map(e=>e.tokenId),d.map(()=>e),d.map(()=>a),d.map(e=>e.amount)),j(""),await n(k,T,e)}catch(e){console.error("Error during withdrawal:",e),e instanceof Error?I(e.message):I("An unknown error occurred during withdrawal. Please try again.")}finally{C(!1)}};return(0,a.jsxs)("div",{className:(0,d.cn)("p-4 glassmorphism"),children:[(0,a.jsx)("h2",{className:(0,d.cn)("text-xl md:text-2xl font-heading mb-4 text-glass text-center"),children:"Withdraw"}),A&&(0,a.jsxs)("div",{className:"bg-red-500/50 text-white p-4 rounded mb-4 backdrop-blur-sm",children:[(0,a.jsx)("p",{className:"font-bold mb-2",children:"Error:"}),(0,a.jsx)("p",{children:A})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-glass mb-2",children:"Select Aavegotchi:"}),(0,a.jsxs)("select",{value:k.length===S.length?"all":k[0],onChange:e=>{let t=e.target.value;"all"===t?v(S.map(e=>e.tokenId)):v([t]),j("")},className:(0,d.cn)("w-full bg-white/20 dark:bg-black/20 text-glass rounded p-2"),children:[(0,a.jsx)("option",{value:"all",children:"All Owned Aavegotchi"}),S.map(e=>(0,a.jsx)("option",{value:e.tokenId,children:e.name||"Aavegotchi #".concat(e.tokenId)},e.tokenId))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-glass mb-2",children:"Token:"}),(0,a.jsxs)("select",{value:b,onChange:e=>{c(e.target.value)},className:(0,d.cn)("w-full bg-white/20 dark:bg-black/20 text-glass rounded p-2"),children:[(0,a.jsx)("option",{value:"ghst",children:"GHST"}),(0,a.jsx)("option",{value:"custom",children:"Custom Token"})]})]}),"custom"===b&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-glass mb-2",children:"Custom Token Address:"}),(0,a.jsx)("input",{type:"text",value:f,onChange:e=>{let t=e.target.value;l(t)},placeholder:"Enter token address",className:(0,d.cn)("w-full bg-white/20 dark:bg-black/20 text-glass rounded p-2")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-glass mb-2",children:"Amount:"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"number",value:T,onChange:e=>j(e.target.value),placeholder:"Enter amount",className:(0,d.cn)("flex-grow bg-white/20 dark:bg-black/20 text-glass rounded p-2")}),(0,a.jsx)(x.E.button,{type:"button",onClick:()=>{let e=BigInt(0),t=S.filter(e=>k.includes(e.tokenId));e=t.reduce((e,t)=>{let n="ghst"===b.toLowerCase()?t.ghstBalance:t.customTokenBalance||"0";return e+r.vz(n,p)},BigInt(0));let n=r.bM(e,p);j(n),console.log("Max amount set: ".concat(n," for ").concat(k.length," Aavegotchi(s), Token Option: ").concat(b,", Token Decimals: ").concat(p))},className:(0,d.cn)("ml-2 px-3 py-2 bg-white/20 dark:bg-black/20 text-glass rounded"),whileHover:{scale:1.05},whileTap:{scale:.95},children:"Max"})]})]})]}),(0,a.jsx)(x.E.button,{type:"submit",disabled:N,className:(0,d.cn)("w-full bg-white/20 dark:bg-black/20 text-glass rounded p-2 mt-4"),whileHover:{scale:1.02},whileTap:{scale:.98},children:N?"Withdrawing...":"Withdraw"})]})]})};var k=n(512),v=n(8388);let T="0x89";var components_GotchiBankingServices=e=>{let{isDarkMode:t,toggleDarkMode:n}=e,[d,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),[x,j]=(0,s.useState)([]),[N,C]=(0,s.useState)(!1),[A,I]=(0,s.useState)("GHST"),[S,E]=(0,s.useState)(!1),[B,_]=(0,s.useState)(""),[L,M]=(0,s.useState)({symbol:"GHST",image:"/images/default-token.png"}),[W,H]=(0,s.useState)("GHST"),[O,P]=(0,s.useState)(18),switchToPolygon=async()=>{if(window.ethereum)try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:T}]}),!0}catch(e){if(4902===e.code)try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:T,chainName:"Polygon Mainnet",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},rpcUrls:["https://polygon-rpc.com/"],blockExplorerUrls:["https://polygonscan.com/"]}]}),!0}catch(e){console.error("Failed to add Polygon network:",e)}console.error("Failed to switch to Polygon network:",e)}return!1},R=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polygon-pos",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"small";try{let a=await fetch("https://api.coingecko.com/api/v3/coins/".concat(t,"/contract/").concat(e.toLowerCase()));if(a.ok){let e=await a.json(),t=e.image||{};return t[n]||"/images/default-token.png"}if(404===a.status)return console.warn("Token not found. Using default image."),"/images/default-token.png";return console.error("Error: Received status code ".concat(a.status," from CoinGecko API.")),"/images/default-token.png"}catch(e){return console.error("An error occurred while fetching token image:",e),"/images/default-token.png"}},[]),F=(0,s.useCallback)(async e=>{try{let t,n;let a=await fetch("https://api.coingecko.com/api/v3/coins/polygon-pos/contract/".concat(e.toLowerCase()));if(!a.ok)throw Error("Failed to fetch token info");await a.json();let s=await R(e),r=window.ethereum?new l.Q(window.ethereum):i.y(),c=new o.CH(e,w,b||r);try{t=await c.symbol()}catch(n){console.warn("Failed to fetch symbol, using address as symbol",n),t=e.slice(0,6)+"..."}try{n=await c.decimals()}catch(e){console.warn("Failed to fetch decimals, using 18 as default",e),n=18}P(n),M({symbol:t.toUpperCase(),image:s}),I(t.toUpperCase())}catch(e){console.error("Error fetching token info:",e),M({symbol:"Unknown",image:"/images/default-token.png"}),P(18)}},[R,b]);(0,s.useEffect)(()=>{F(g)},[F]);let z=(0,s.useCallback)(async()=>{if(window.ethereum)try{let e=await window.ethereum.request({method:"eth_chainId"});if(e!==T){let e=await switchToPolygon();if(!e){C(!1);return}}C(!0);let t=new l.Q(window.ethereum),n=await t.listAccounts();if(n.length>0){let e=await t.getSigner(),n=await e.getAddress();u(n),f(e);let a=new o.CH(h,y,e);p(a),fetchAavegotchis(n,a)}else u(null),f(null),p(null),j([])}catch(e){console.error("Error checking connection:",e)}},[]);(0,s.useEffect)(()=>(z(),window.ethereum&&(window.ethereum.on("accountsChanged",z),window.ethereum.on("chainChanged",z)),()=>{window.ethereum&&(window.ethereum.removeListener("accountsChanged",z),window.ethereum.removeListener("chainChanged",z))}),[z]);let connectWallet=async()=>{if(window.ethereum)try{await window.ethereum.request({method:"eth_requestAccounts"}),z()}catch(e){console.error("Error connecting wallet:",e)}else alert("Please install MetaMask or another Ethereum wallet to use this dApp.")},fetchAavegotchis=async(e,t)=>{try{console.log("Fetching Aavegotchis for address:",e);let n=await t.balanceOf(e);console.log("Balance:",n.toString());let a=[];for(let s=0;s<n;s++){let n=await t.tokenOfOwnerByIndex(e,s);console.log("Token ID ".concat(s,":"),n.toString()),a.push(n.toString())}let s=t.runner,l=new o.CH(g,w,s),i=await l.decimals(),c=await Promise.all(a.map(async e=>{let n=await t.getAavegotchi(e),a=n.escrow,s=await l.balanceOf(a),o=await t.isAavegotchiLent(e);return{tokenId:e,name:n.name,escrowWallet:a,ghstBalance:r.bM(s,i),customTokenBalance:"0",isLent:o}}));console.log("Processed Aavegotchi Data:",c),j(c)}catch(e){console.error("Error fetching Aavegotchis:",e),j([])}},D=(0,s.useCallback)(async()=>{if(!m||!b||0===x.length)return;let e=await Promise.all(x.map(async e=>{let t=e.ghstBalance,n=e.customTokenBalance||"0";try{let n=new o.CH(g,w,b),a=await n.balanceOf(e.escrowWallet);t=r.bM(a,18)}catch(n){console.warn("Failed to fetch GHST balance for Aavegotchi ".concat(e.tokenId),n),t="0"}if(S&&B&&c.UJ(B))try{let t=new o.CH(B,w,b),a=await t.balanceOf(e.escrowWallet);n=r.bM(a,O)}catch(t){console.warn("Failed to fetch custom token balance for Aavegotchi ".concat(e.tokenId),t),n="0"}else n="0";return{...e,ghstBalance:t,customTokenBalance:n}}));j(e)},[m,b,x,S,B,O]);(0,s.useEffect)(()=>{D()},[D]);let G=(0,s.useCallback)(async e=>{if(!m||!b||!e||!c.UJ(e)){M({symbol:"",image:"/images/default-token.png"}),E(!1),_("");return}try{await F(e),_(e),E(e.toLowerCase()!==g.toLowerCase()),console.log("Updating Aavegotchi balances..."),await D()}catch(e){console.error("Error fetching custom token info:",e),I(""),M({symbol:"",image:"/images/default-token.png"}),E(!1),P(18),_("")}},[m,b,F,D]),U=(0,s.useCallback)(()=>{M({symbol:"",image:"/images/default-token.png"}),E(!1),P(18),_("")},[]),q=(0,s.useCallback)(async(e,t,n)=>{if(!m||!b){console.error("Contract or signer not initialized");return}try{console.log("Attempting to withdraw ".concat(t," of token ").concat(n," from Aavegotchis:"),e);let a=r.vz(t,O),s=await b.getAddress(),l=e.map(e=>({tokenId:e,amount:a}));console.log("Performing batch withdrawal:",l);let i=await m.batchTransferEscrow(l.map(e=>e.tokenId),l.map(()=>n),l.map(()=>s),l.map(e=>e.amount));await i.wait(),console.log("Withdrawal transaction successful"),await D()}catch(e){throw console.error("Error during withdrawal:",e),e}},[m,b,O,D]),J=(0,s.useCallback)(async e=>{H(e),"GHST"===e?(E(!1),_(g),P(18),await F(g),await D()):"custom"===e&&(_(""),M({symbol:"",image:"/images/default-token.png"}),E(!0))},[F,D]),Q={aavegotchis:x,onWithdraw:q,onCustomTokenChange:G,signer:b,onTokenSelection:J,tokenSymbol:L.symbol,onCustomTokenInvalid:U,tokenDecimals:O,isDarkMode:t,tokenOption:W,customTokenAddress:B};return(0,a.jsx)("div",{className:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,v.m6)((0,k.W)(t))}("min-h-screen p-4 md:p-6 overflow-x-hidden bg-gradient-radial from-white/10 via-white/20 to-white/10 dark:from-black/20 dark:via-black/40 dark:to-black/20",t?"text-darkText":"text-text"),children:(0,a.jsxs)("div",{className:"max-width-container",children:[(0,a.jsx)(components_TopSection,{contractAddress:h,network:"Polygon Mainnet",walletAddress:d,onConnectWallet:connectWallet,aavegotchis:x,customTokenSymbol:A,isCustomToken:S,tokenImage:L.image,isDarkMode:t,toggleDarkMode:n,signer:b,tableContainerClass:"max-w-6xl mx-auto"}),(0,a.jsx)(WithdrawalForm,{...Q})]})})}}}]);